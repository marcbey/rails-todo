<% content_for :title, @group.name %>

<div class="grid gap-6 lg:grid-cols-[240px_1fr]">
  <aside class="rounded-3xl border border-slate-800 bg-slate-900/60 p-5">
    <%= turbo_stream_from [current_user, :groups] %>
    <div class="flex items-center justify-between">
      <h2 class="text-xs font-semibold uppercase tracking-wide text-slate-400">Groups</h2>
      <%= link_to "New", groups_path, class: "text-xs font-semibold text-slate-200 hover:text-white" %>
    </div>
    <div class="mt-4 space-y-2">
      <div id="user_groups_sidebar">
        <%= render "groups/sidebar_list", groups: @sidebar_groups, current_group_id: @group.id %>
      </div>
    </div>
  </aside>

  <section class="rounded-3xl border border-slate-800 bg-slate-900/40 p-6">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h1 class="text-2xl font-semibold"># <%= @group.name %></h1>
        <p class="mt-1 text-sm text-slate-400">
          <span id="member_count"><%= render "memberships/count", count: @memberships.count %></span> in this group
        </p>
      </div>
      <% if @group.memberships.find_by(user: current_user)&.role_owner? %>
        <div class="rounded-2xl border border-slate-800 bg-slate-950/70 p-4">
          <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-400">Invite member</h3>
          <%= turbo_frame_tag "member_form" do %>
            <%= render "memberships/form", group: @group, membership: @membership, member_error: nil %>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="mt-6 grid gap-6 lg:grid-cols-[1fr_240px]">
      <div class="rounded-2xl border border-slate-800 bg-slate-950/40 p-4">
        <%= turbo_stream_from @group %>
        <div id="messages" class="space-y-4">
          <% if @messages.any? %>
            <%= render @messages %>
          <% else %>
            <div class="rounded-2xl border border-dashed border-slate-800 px-4 py-6 text-center text-sm text-slate-400">
              No messages yet. Start the conversation.
            </div>
          <% end %>
        </div>
      </div>

      <aside class="rounded-2xl border border-slate-800 bg-slate-950/40 p-4">
        <%= turbo_stream_from [@group, :members] %>
        <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-400">Members</h3>
        <div id="members_list" class="mt-3 space-y-2">
          <%= render partial: "memberships/list", locals: { group: @group, memberships: @memberships } %>
        </div>
      </aside>
    </div>

    <div class="mt-6">
      <%= turbo_frame_tag "message_form" do %>
        <%= render "messages/form", group: @group, message: @message %>
      <% end %>
    </div>
  </section>
</div>
